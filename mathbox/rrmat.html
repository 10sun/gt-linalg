<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MathBox - Matrix</title>
  <script src="build/mathbox-bundle.js"></script>
  <link rel="stylesheet" href="build/mathbox.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.js"></script>
  <script src="animstate.js"></script>
  <script src="rrmat.js"></script>
  <script src="domready.js"></script>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <style>
  .baseline-detect {
      display: inline-block;
      height:  0px;
  }
  .bound-entry {
      position: relative;
      top:      0px;
      display:  inline-block;
  }
  .mult-flyer {
      color: blue;
  }
  .rrep-factor {
      color: blue;
  }

  .centered {
      text-align: center;
  }
  .slideshow {
      width: 800px;
      margin-top: 16px;
      margin-bottom: 16px;
      display: inline-block;
      font-family: sans-serif;
  }
  .controls {
      display: inline-block;
  }
  .control-button {
      border: none;
      display: inline-block;
      padding: 8px 0px;
      vertical-align: middle;
      position: relative;
      width: 56px;
      height: 56px;
  }
  .icon-arrow {
      width: 48px;
      height: 56px;
      display: inline-block;
      position: relative;
      cursor: pointer;
      text-align: left;
  }
  .icon-arrow.inactive {
      cursor: default;
  }
  .icon-arrow.prev-button {
      transform: scale(-1,1);
  }
  .icon-arrow span {
      float: left;
  }
  .icon-arrow span:nth-child(1) {
      width: 25px;
      height: 32px;
      margin-right: -1px;
      margin-top: 12px;
      background: #99afbb;
  }
  .icon-arrow:hover span:nth-child(1) {
      background: #57c4ff;
  }
  .icon-arrow.inactive span:nth-child(1) {
      background: #d1dbe0;
  }
  .icon-arrow span:nth-child(2) {
      border-left: 24px solid #99afbb;
      border-bottom: 28px solid transparent;
      border-top: 28px solid transparent;
  }
  .icon-arrow:hover span:nth-child(2) {
      border-left: 24px solid #57c4ff;
  }
  .icon-arrow.inactive span:nth-child(2) {
      border-left: 24px solid #d1dbe0;
  }
  .icon-repeat {
      width: 48px;
      height: 56px;
      display: inline-block;
      position: relative;
      cursor: pointer;
  }
  .icon-repeat.inactive {
      cursor: default;
  }
  .icon-repeat span {
      position: absolute;
  }
  .icon-repeat span:nth-child(1) {
      top: 10px;
      left: 10px;
      width: 21px;
      height: 46px;
      border-left: 0px solid #99afbb;
      border-top: 11px solid #99afbb;
      border-top-left-radius: 24px;
      border-bottom-left-radius: 24px;
  }
  .icon-repeat:hover span:nth-child(1) {
      border-left: 0px solid #57c4ff;
      border-top: 11px solid #57c4ff;
  }
  .icon-repeat.inactive span:nth-child(1) {
      border-left: 0px solid #d1dbe0;
      border-top: 11px solid #d1dbe0;
  }
  .icon-repeat span:nth-child(2) {
      bottom: 10px;
      right: 10px;
      width: 21px;
      height: 46px;
      border-right: 0px solid #99afbb;
      border-bottom: 11px solid #99afbb;
      border-bottom-right-radius: 24px;
      border-top-right-radius: 24px;
  }
  .icon-repeat:hover span:nth-child(2) {
      border-right: 0px solid #57c4ff;
      border-bottom: 11px solid #57c4ff;
  }
  .icon-repeat.inactive span:nth-child(2) {
      border-right: 0px solid #d1dbe0;
      border-bottom: 11px solid #d1dbe0;
  }
  .icon-repeat span:nth-child(3) {
      border-left: 13px solid #99afbb;
      border-top: 11px solid transparent;
      border-bottom: 11px solid transparent;
      left: 30px;
      top: 5px;
  }
  .icon-repeat:hover span:nth-child(3) {
      border-left: 13px solid #57c4ff;
  }
  .icon-repeat.inactive span:nth-child(3) {
      border-left: 13px solid #d1dbe0;
  }
  .icon-repeat span:nth-child(4) {
      border-right: 13px solid #99afbb;
      border-top: 11px solid transparent;
      border-bottom: 11px solid transparent;
      right: 30px;
      bottom: 5px;
  }
  .icon-repeat:hover span:nth-child(4) {
      border-right: 13px solid #57c4ff;
  }
  .icon-repeat.inactive span:nth-child(4) {
      border-right: 13px solid #d1dbe0;
  }
  .pages {
      display: inline-block;
      text-align: center;
      width: 100px;
      color: #99afbb;
  }
  .slides {
      display: inline-block;
      float: right;
      width: 70%;
      text-align: left;
      color: #353535;
      height: 20px;  /* just needs to be > 0 */
  }
  .slides > .slide {
      height: 0px;
  }
  .slides > .slide.inactive {
      visibility: hidden;
  }
  </style>
</head>
<body>
    <div style="width: 800px; height: 300px; margin-top: 0px; border: 0px solid black; margin-left: auto; margin-right: auto;" id="mathbox"></div>
    <div class="centered">
        <div class="slideshow rrmat">
            <div class="controls">
                <span class="control-button">
                    <span class="icon-arrow prev-button inactive">
                        <span></span><span></span>
                    </span>
                </span>
                <span class="control-button">
                    <span class="icon-repeat reload-button inactive">
                        <span></span><span></span><span></span><span></span>
                    </span>
                </span>
                <span class="control-button" id="next-button">
                    <span class="icon-arrow next-button">
                        <span></span><span></span></span>
                </span><br>
                <span class="pages"></span>
            </div>
            <div class="slides">
                <div class="slide">
                    Let's row reduce this matrix.
                </div>
                <div class="slide inactive">
                    These are the pivots in the first column.
                </div>
                <div class="slide inactive">
                    These are the pivots in the first column.
                    We need to move one of them to the first row.
                </div>
                <div class="slide inactive">
                    Make this entry a 1 by dividing by 2.
                </div>
                <div class="slide inactive">
                    Let's get rid of this distracting line.
                </div>
                <div class="slide inactive immediate">
                    We kill this entry...
                </div>
                <div class="slide inactive immediate">
                    We kill this entry...
                </div>
                <div class="slide inactive immediate">
                    We kill this entry by subtracting 3 times the first row.
                </div>
                <div class="slide inactive">
                    Now that the first column is clear except for the pivot in
                    the first row, we can ignore the first row and the first
                    column and concentrate on the rest of the matrix.
                </div>
                <div class="slide inactive">
                    Both of the remaining entries in the second column are pivots.
                </div>
                <div class="slide inactive">
                    Both of the remaining entries in the second column are pivots.
                </div>
                <div class="slide inactive">
                    We'll use the bottom entry as our pivot...
                </div>
                <div class="slide inactive">
                    We'll use the bottom entry as our pivot, so we have to switch columns.
                </div>
                <div class="slide inactive">
                    We'll use the bottom entry as our pivot, so we have to switch columns.
                </div>
                <div class="slide inactive">
                    Divide row 2 by -5 to make this pivat a 1.
                </div>
                <div class="slide inactive">
                    Divide row 2 by -5 to make this pivat a 1.  (The other
                    entries in this row are divisible by 5; that's why we used
                    this row as the pivot row.)
                </div>
                <div class="slide inactive">
                    To kill this entry...
                </div>
                <div class="slide inactive">
                    To kill this entry, we add 7 times row 2 to row 3.
                </div>
                <div class="slide inactive">
                    To kill this entry, we add 7 times row 2 to row 3.
                </div>
                <div class="slide inactive">
                    Now the second column (the part we care about) is clear
                    except for the pivot in the pivot, so we can ignore the
                    second column and second row.
                </div>
                <div class="slide inactive">
                    The first nonzero entry of the last row is a pivot.
                </div>
                <div class="slide inactive">
                    The first nonzero entry of the last row is a pivot.
                </div>
                <div class="slide inactive">
                    We divide by 10 to make it equal to 1.
                </div>
                <div class="slide inactive">
                    We divide by 10 to make it equal to 1.
                </div>
                <div class="slide inactive">
                    Notice that the matrix is now in <i>row echelon form</i>.
                </div>
                <div class="slide inactive">
                    Notice that the matrix is now in <i>row echelon form</i>.
                </div>
                <div class="slide inactive">
                    To put the matrix in <i>reduced</i> row echelon form, we
                    need to clear the entries in <span style="color: blue;">blue</span>.
                </div>
                <div class="slide inactive">
                    To put the matrix in <i>reduced</i> row echelon form, we
                    need to clear the entries in <span style="color: blue;">blue</span>.
                </div>
                <div class="slide inactive">
                    We do this by taking advantage of the pivots in each column
                    and doing row replacement.
                </div>
                <div class="slide inactive">
                    We do this by taking advantage of the pivots in each column
                    and doing row replacement.
                </div>
                <div class="slide inactive">
                    First we clear the second column...
                </div>
                <div class="slide inactive">
                    First we clear the second column by subtracting 2 times the
                    second row from the first.
                </div>
                <div class="slide inactive">
                    First we clear the second column by subtracting 2 times the
                    second row from the first.
                </div>
                <div class="slide inactive">
                    Now we clear the third column...
                </div>
                <div class="slide inactive">
                    Now we clear the third column in the same way.
                </div>
                <div class="slide inactive">
                    Now we clear the third column in the same way.
                </div>
                <div class="slide inactive">
                    The matrix is now in reduced row echelon form!
                </div>
                <div class="slide inactive">
                    The matrix is now in reduced row echelon form!
                </div>
                <div class="slide inactive">
                    Add back the divider...
                </div>
                <div class="slide inactive">
                    Add back the divider, and we're done!
                </div>
            </div>
        </div>
    </div>

    <script>
    "use strict";

    if(false) {
        window.onload = function() {console.log("loaded");}

        function txt(x) {return "<span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>+</mo><mn>1</mn><mspace width=\"0.16667em\"></mspace><mo fence=\"true\">(</mo></mrow><annotation encoding=\"application/x-tex\">+1\\,\\bigl(</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.85em;\"></span><span class=\"strut bottom\" style=\"height:1.20001em;vertical-align:-0.35001em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">" + x + "</span><span class=\"mord mspace thinspace\"></span><span class=\"mopen\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing size1\">(</span></span></span></span></span></span>";}

        var div = document.createElement('div');
        div.style.position  = 'absolute';
        div.style.left      = '0px';
        div.style.top       = '0px';
        div.style.width     = '0px';
        div.style.height    = '0px';
        document.body.appendChild(div);
        var span = document.createElement('span');
        span.addEventListener('transitionend', function(event) {
            console.log("transitionend");
            console.log(span.getBoundingClientRect());
        });
        span.id = 'width-measurer';
        span.style.whiteSpace  = 'nowrap';
        span.style.padding     = '0px';
        span.style.border      = 'none';
        span.style.transition  = 'color 0.01s';
        window.testSpan = span;
        div.appendChild(span);
        katex.render('+1(', span);

        var test = function(n) {
            // span.innerHTML = txt(n);
            katex.render('+'+n+'(', span);
            var i = 0;
            function testFunc() {
                var rect = span.getBoundingClientRect();
                console.log(rect);
                document.getElementById("mathbox").innerHTML += (rect.width+'<br>');
                if(i++ < 5)
                    window.requestAnimationFrame(testFunc);
            }
            testFunc();
            var observer = new MutationObserver(function(mutations, observer) {
                console.log(mutations);
                console.log(span.getBoundingClientRect());
                console.log(span.children[0].children[0].children[0].children[0].children[0]);
            });
            //observer.observe(span, {characterData: true, subtree: true, attributes: true, childList: true});
        }
    }


    if(true) DomReady.ready(function() {
        var ortho = 10000;
        var width = 800;
        var height = 300;

        var mathbox = window.mathbox = mathBox({
            element: document.getElementById("mathbox"),
            size: { width: width, height: height },
            plugins: ['core', 'controls'],
            mathbox: {
                warmup: 2,
                splash: true,
                inspect: false,
            },
            splash: {fancy: true, color: "blue"},
            camera: {
                near: ortho / 4,
                far: ortho * 4,
                lookAt: -width/4,
            },
            controls: {
                // Orbit controls, i.e. Euler angles, with gimbal lock
                klass: THREE.OrbitControls,

                // Trackball controls, i.e. Free quaternion rotation
                //klass: THREE.TrackballControls,
            },
        });
        if (mathbox.fallback) throw "WebGL not supported"

        var three = mathbox.three;
        three.renderer.setClearColor(new THREE.Color(0xFFFFFF), 1.0);

        // Place camera
        var camera =
            mathbox
                .camera({
                    proxy: false,
                    position: [0, 0, ortho],
                    fov: Math.atan(height/ortho) * 360 / π,
                    lookAt: [width/4,0,0],
                });

        // 2D cartesian
        var view =
            mathbox
                .cartesian({
                    range: [[-width/2, width/2], [-height/2, height/2], [-50,50]],
                    scale: [width, height, 100],
                });

        // Calibrate focus distance for units
        mathbox.set('focus', ortho);

        window.rrmat = new RRMatrix(3, 4, view, mathbox,
                                    {augmentCol: 2, startAugmented: true});
        rrmat.setMatrix([[0, -7, -4,  2],
                         [2,  4,  6, 12],
                         [3,  1, -1, -2]]);

        function blink(color, entries, times) {
            if(!times) {times = 2;}
            var arr = [], last, delay = 0;
            for(var i = 0; i < times; ++i) {
                arr.push({color: color,
                          transform: "scale(2,2)",
                          entries:   entries,
                          duration:  0.4,
                          delay:     delay});
                delay += 0.4;
                last = {color:     "black",
                        transform: "",
                        entries:   entries,
                        duration:  0.4,
                        delay:     delay};
                delay += 0.4;
                arr.push(last);
            }
            delete last.color;
            return arr;
        }
        window.blink = blink;

        window.slideshow =
            rrmat.slideshow()

                 .combine()
                 .nextCaption()
                 .setStyle(blink("red", [[1,0],[2,0]]))
                 .combined()

                 .combine()
                 .setStyle({color: "black",
                            entries: [[2,0]],
                            duration: 0.2})
                 .rowSwap(0, 1)
                 .combined()

                 .combine()
                 .setStyle(blink("red", [[0,0]], 1))
                 .rowMult(0, 1/2)
                 .combined()

                 .combine()
                 .unAugment()
                 .nextCaption()
                 .setStyle(blink("blue", [[2,0]], 1))
                 .combined()

                 .combine()
                 .nextCaption()
                 .rowRep(0, -3, 2)
                 .setStyle({color: "black",
                            entries: [[2,0]],
                            duration: 0.2})
                 .combined()

                 .combine()
                 .setStyle({color: "rgb(200,200,200)",
                            entries: [[0,0],[0,1],[0,2],[0,3],[1,0],[2,0]],
                            duration: 0.5})
                 .nextCaption()
                 .setStyle(blink("red", [[1,1],[2,1]]))
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle({color: "black",
                            entries: [[1,1]],
                            duration: 1})
                 .nextCaption()
                 .rowSwap(1, 2)
                 .combined()

                 .combine()
                 .nextCaption()
                 .rowMult(1, -1/5)
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle(blink("blue", [[2,1]], 1))
                 .nextCaption()
                 .rowRep(1, 7, 2)
                 .setStyle({color: "black",
                            entries: [[2,1]],
                            duration: 0.2})
                 .nextCaption()
                 .combined()

                 .combine()
                 .setStyle({color: "rgb(200,200,200)",
                            entries: [[1,1],[1,2],[1,3],[2,1]],
                            duration: 1})
                 .nextCaption()
                 .setStyle(blink("red", [[2,2]]))
                 .combined()

                 .combine()
                 .nextCaption()
                 .rowMult(2, 1/10)
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle([{color: "red",
                             entries: [[0,0],[1,1],[2,2]],
                             duration: 1},
                            {color: "black",
                             entries: [[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]],
                             duration: 1}])
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle([{color: "black",
                             entries: [[0,0],[1,1],[2,2]],
                             duration: 1}]
                     .concat(blink("blue", [[0,1],[0,2],[1,2]], 1)))
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle(blink("red", [[1,1],[2,2]]))
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle([{color: "black",
                             entries: [[0,2], [1,2], [2,2]],
                             duration: 1}]
                     .concat(blink("red", [[1,1]], 1))
                     .concat(blink("blue", [[0,1]], 1)))
                 .nextCaption()
                 .rowRep(1, -2, 0)
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle([{color: "black",
                             entries: [[0,1],[1,1]],
                             duration: 1}]
                     .concat(blink("red", [[2,2]], 1))
                     .concat(blink("blue", [[0,2],[1,2]], 1)))
                 .nextCaption()
                 .rowRep(2, -2, 1, {speed: 2})
                 .rowRep(2,  1, 0, {speed: 2})
                 .combined()

                 .combine()
                 .nextCaption()
                 .setStyle([{color: "black",
                             entries: [[1,0],[2,0],[2,1],[0,2],[1,2]],
                             duration: 1},
                            {color: "red",
                             entries: [[0,0],[1,1]],
                             duration: 1}])
                 .combined()

                 .combine()
                 .nextCaption()
                 .reAugment()
                 .setStyle({transform: "rotate(360deg)",
                            entries: [[0,0],[0,1],[0,2],[0,3],
                                      [1,0],[1,1],[1,2],[1,3],
                                      [2,0],[2,1],[2,2],[2,3]],
                            duration: 1.5,
                            timing: 'linear'})
                 .combined()
    });

    </script>
</body>
</html>
